var userAgent=window.navigator.userAgent,isIE=-1<userAgent.indexOf("MSIE ")||-1<userAgent.indexOf("Trident/");if(!isIE){var iPerceptions=iPerceptions||{};iPerceptions.Wrapper={token:"eabaab3f-1019-419e-8fe2-aa24decf6449",inviteId:"IPinvite.eabaab3f-1019-419e-8fe2-aa24decf6449",inviteUrl:"https://npssurveyinvite.services.lego.com/InviteTriggers",engineId:"IPengine",definitionId:"IPdef.eabaab3f-1019-419e-8fe2-aa24decf6449",device:"",culture:"",sId:"",visits:"",visit:"",engineUrl:"https://npssurveyinvite.services.lego.com/v1/survey_engine.min.js",dataUrl:"",companyId:"",frameUrl:"https://npssurveyinvite.services.lego.com/v1/iframe.html",iFrameUrl:"https://npssurveyinvite.services.lego.com",frameId:"iPerceptionsFrame",visitsId:"iperceptions.com",pageUrl:location.href,init:function(){if(!/MSIE [67]\.(?!.*Trident[1-9])/.test(navigator.userAgent))try{this.sId=this.setAndGetCookie("ipe_s"),this.visits=JSON.parse(this.getStorageCookie(this.visitsId));var e=this.getStorageCookie(this.inviteId);e&&"null"!==e?this.store(this.inviteId,e):this.getJs(this.inviteUrl,this.store,this.inviteId)}catch(e){try{this.getJs(this.inviteUrl,this.inject,this.inviteId)}catch(e){}}},getApiObj:function(e){if(e)try{var t=JSON.parse(e);this.device=t.Device,this.culture=t.Culture,this.dataUrl=t.DataUrl.replace(/^(https?):\/\//,"//"),void 0!==this.visits&&this.visits&&this.visits instanceof Array||(this.visits=[]);for(var i=0;i<this.visits.length;i++)if(this.visits[i].id===this.token){this.visit=this.visits[i];break}this.visit=this.visit||{},this.visit.id=this.token,this.visit.history=this.visit.history||[];var n=this.visit.visitors||[];n.push({id:t.VisitorId,time:new Date,host:location.host}),this.visit.visitors=n.length<=10?n:n.slice(Math.max(n.length-10,1))}catch(e){}else window.console&&console.warn("iPerceptions Warning: Domain validation does not find "+window.location.hostname)},store:function(e,t){try{var i=iPerceptions.Wrapper;return i.getApiObj(t),i.setStorageCookie(e,t,null,"session"),void i.injectJs(i.engineId,i.engineUrl,null,i.injectDataScript,i)}catch(e){}},inject:function(e,t){var i=iPerceptions.Wrapper;try{i.getApiObj(t),i.injectJs(i.engineId,i.engineUrl),i.injectJs(i.definitionId,i.dataUrl,null,i.callEngine)}catch(e){}},injectJs:function(e,t,i,n,s){var r=document.createElement("script");r.id=e,t&&(r.src=t),i&&(r.text=i),r.type="text/javascript";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(r,o),null!=n&&this.afterInjection(r,n,s)},afterInjection:function(e,t,i){e.readyState?e.onreadystatechange=function(){("loaded"==e.readyState||"complete"==e.readyState)&&(e.onreadystatechange=null,t(i))}:e.onload=function(){t(i)}},getJs:function(e,t,i){if(window.XDomainRequest){var n=new XDomainRequest;n.open("get",e+"?SecurityToken="+this.token),n.onload=function(){t(i,n.responseText)},n.send()}else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.setRequestHeader("SecurityToken",this.token),s.onload=function(){t(i,this.response)},s.send(this.token)}},injectDataScript:function(e){e.injectJs(e.definitionId,e.dataUrl,null,e.storeDef,e)},storeDef:function(e){try{sessionStorage.setItem(e.definitionId,JSON.stringify(ipDef))}catch(e){}e.callEngine()},callEngine:function(e,t){"string"==typeof e&&0<e.length&&(iPerceptions.Wrapper.pageUrl=e),"boolean"!=typeof t&&(t=!0);var i=iPerceptions.Wrapper;"undefined"!=typeof ipDef&&ipDef&&0<ipDef.Invites.length&&(i.companyId=ipDef.Invites[0].CompanyId,"object"==typeof iPerceptions.ipEngine?iPerceptions.ipEngine.launch(ipDef,i.device,i.culture,i.visit,iPerceptions.Wrapper.pageUrl,t):setTimeout(i.callEngine(iPerceptions.Wrapper.pageUrl),500))},getCookie:function(e){var t,i,n=document.cookie.split(";");for(t=0;t<n.length;t+=1){for(i=n[t];" "===i.charAt(0);)i=i.substring(1);if(-1!==i.indexOf(e))return i.substring(e.length+1,i.length)}return""},setCookie:function(e,t,i){t&&512<t.toString().length||(document.cookie=i?e+"="+t+";expires="+i+";path=/":e+"="+t+";path=/")},setAndGetCookie:function(e){var t=this.getCookie(e);return""===t&&(t=this.guid(),this.setCookie(e,t)),t},setStorageCookie:function(t,i,n,e){try{"session"===e?sessionStorage.setItem(t,i):this.saveToFrame(t,i)}catch(e){this.setCookie(t,i,n)}},getStorageCookie:function(e,t){var i;try{i="session"===t?sessionStorage.getItem(e):localStorage.getItem(e)}catch(e){}return i||this.getCookie(e)},getPageViewed:function(e){var t,i,n;return"boolean"!=typeof e&&(e=!0),t=this.getStorageCookie("ipe."+this.companyId+".pageViewed","session"),n=this.getCookie("ipe."+this.companyId+".pageViewedCount"),i=t?t.split(","):[],n=parseInt(n)||0,iPerceptions.Wrapper.pageUrl!==i[i.length-1]&&e&&((i=[]).push(iPerceptions.Wrapper.pageUrl),n+=1),t=i.join(","),this.setStorageCookie("ipe."+this.companyId+".pageViewed",t,null,"session"),this.setCookie("ipe."+this.companyId+".pageViewedCount",n),n},getInvitesKey:function(){return"ipe."+this.companyId+".winning"},getInvites:function(){return this.getIframeSessionStorage(this.getInvitesKey())},setInvites:function(e){this.setIframeSessionStorage(this.getInvitesKey(),e)},updateVisit:function(e,t){for(var i=!1,n=0;n<this.visits.length&&!i;n++)this.visits[n].id===e.id&&(this.visits[n]=e,i=!0);i||this.visits.push(e),this.setStorageCookie(this.visitsId,JSON.stringify(this.visits),t)},objToString:function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+"::"+e[i]+"\n");return t},seed:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.seed()+this.seed()+"-"+this.seed()+"-"+this.seed()+"-"+this.seed()+"-"+this.seed()+this.seed()+this.seed()},stringToObj:function(e){try{var t,i=JSON.parse(e);for(t in i)i.hasOwnProperty(t)&&"string"==typeof i[t]&&2<i[t].length&&"{"==i[t][0]&&"}"==i[t][i[t].length-1]&&(i[t]=this.stringToObj(i[t]));return i}catch(e){}},addEvent:function(e,t){window.addEventListener?window.addEventListener(e,t):window.attachEvent("on"+e,t)},saveToFrame:function(e,t){var i=iPerceptions.Wrapper,n=document.getElementById(this.frameId).contentWindow;localStorage.setItem(e,t),n.postMessage(JSON.stringify({key:e,method:"set",data:t}),i.iFrameUrl)},setIframeSessionStorage:function(e,t){var i=iPerceptions.Wrapper,n=document.getElementById(this.frameId).contentWindow;this.setStorageCookie(e,t,null,"session"),n.postMessage(JSON.stringify({key:e,method:"setsession",data:t}),i.iFrameUrl)},getSessionEventObj:{invites:null,handleEvent:function(e){if(0<=e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl)){var t=JSON.parse(e.data);if("universalgetsession"==t.source){var i=iPerceptions.Wrapper;iPerceptions.ipEngine.evaluateRate(this.invites,t.value,ipDef,i.device,i.culture,i.visit,i.sId,i.token),window.removeEventListener("message",iPerceptions.Wrapper.getSessionEventObj)}}}},getIframeSessionStorage:function(e,t){try{var i=iPerceptions.Wrapper;document.getElementById(i.frameId).contentWindow.postMessage(JSON.stringify({key:e,method:"getsession"}),i.iFrameUrl),iPerceptions.Wrapper.getSessionEventObj.invites=t,i.addEvent("message",iPerceptions.Wrapper.getSessionEventObj)}catch(e){}},saveAndRestoreLocalStorage:function(){var e=iPerceptions.Wrapper;document.getElementById(e.frameId).contentWindow.postMessage(JSON.stringify({key:e.visitsId,method:"get"}),e.iFrameUrl),setTimeout(function(){e.init()},300)},storageFromFrame:function(){try{var i=iPerceptions.Wrapper;if(!document.getElementById(i.frameId)){var e=document.createElement("iframe");e.src=i.frameUrl,e.style.display="none",e.id=i.frameId,e.title=i.frameId,document.getElementsByTagName("body")[0].appendChild(e);var n=i.visitsId;i.afterInjection(e,i.saveAndRestoreLocalStorage),i.addEvent("message",function(e){try{if(0<=e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl)){var t=JSON.parse(e.data);"universal"==t.source&&i.setStorageCookie(n,t.value)}}catch(e){}})}}catch(e){}},exec:function(e,t){iPerceptions.Wrapper.callEngine(e,t)},attachPushStateHandler:function(){var t=window.history.pushState;window.history.pushState=function(e){return document.cookie.match(/IPE_M_[0-9]{6}/)||iPerceptions.Wrapper.exec(document.location.href,!0),t.apply(window.history,arguments)}},onDocumentComplete:function(){iPerceptions.Wrapper.storageFromFrame(),iPerceptions.Wrapper.attachPushStateHandler()}},"complete"==document.readyState?iPerceptions.Wrapper.onDocumentComplete():iPerceptions.Wrapper.addEvent("load",iPerceptions.Wrapper.onDocumentComplete)}