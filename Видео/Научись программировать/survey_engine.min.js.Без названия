"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var iPerceptions=iPerceptions||{};iPerceptions.ipEngine={invitePath:"https://npssurveyinvite.services.lego.com/v1/invitations/",commentCardUrls:[],device:"",culture:"",langId:0,pageViewed:0,expoTemplateId:-24,launch:function(e,t,i,n,r,o){"use strict";var s,a,c,l=iPerceptions.Wrapper;n.visitors[n.visitors.length-1].id;try{this.hideExistingProjects(),this.device=t.toLowerCase(),this.culture=i;var p,g=!1,u=JSON.parse(e.Domains),d=location.host;for(s=0;s<u.length;s+=1){if(p=u[s].substring(1),d===u[s]){g=!0;break}if("*."===u[s].substring(0,2)&&-1!==d.indexOf(p,d.length-p.length)){g=!0;break}}if(!g)return;for(this.pageViewed=l.getPageViewed(o),this.setFovCookie(),a=e.Invites,s=0;s<a.length;s++)(c=a[s]).ProjectInviteTriggers=this.shuffleObject(c.ProjectInviteTriggers),-10===c.TemplateId&&this.evaluateInvite(c)&&l.injectJs("Iperceptions_"+c.ProjectId.toString(),c.CommentCardUrl,null,function(){var e={langID:langId};ipeCC[0].ipeIcon(e)});a=this.reinvite(a,n.history),a=l.getIframeSessionStorage(iPerceptions.Wrapper.getInvitesKey(),a)}catch(e){}},hideExistingProjects:function(){for(var e=document.getElementsByTagName("img"),t=0;t<e.length;t++)0<=e[t].id.indexOf("UIF-IMG-")&&e[t].parentNode.removeChild(e[t]);var i=document.getElementsByTagName("iframe");for(t=0;t<i.length;t++)(0<=i[t].id.indexOf("artEXPOiFrame")||0<=i[t].id.indexOf("iPSliderFrame"))&&i[t].parentNode.removeChild(i[t]);var n=document.getElementById("IPUBI16_bannerInvite");null!=n&&n.parentNode.removeChild(n);var r=document.getElementsByTagName("div");for(t=0;t<r.length;t++)0==r[t].id.indexOf("IPEI")&&r[t].id==r[t].className&&r[t].parentNode.removeChild(r[t])},displayInvite:function(e,t,i,n,r,o,s){var a,c,l,p=iPerceptions.Wrapper,g=r.visitors[r.visitors.length-1].id;e=this.shuffleObject(e);var u=[];for(a=0;a<e.length;a++)iPerceptions.ipEngine.expoTemplateId==e[a].TemplateId&&u.push(e[a]);var d=!1;for(a=0;a<u.length&&!d;a++)for(var v=(c=u[a]).ProjectInviteTriggers,h=0;h<v.length;h++){var f=v[h];if(!0===this.evaluateTrigger(f)){d=!0,this.injectInvite(c,f,g,o,i,r,l);break}}for(a=0;a<e.length;a++)if(c=e[a],iPerceptions.ipEngine.expoTemplateId!==e[a].TemplateId)for(h=0;h<c.ProjectInviteTriggers.length;h++)if(f=c.ProjectInviteTriggers[h],null!=s){var I=s.split(",");if(c.ProjectId==I[0]&&f.Id==I[1])return void this.injectInvite(c,f,g,o,i,r,l)}else if(!0===this.evaluateTrigger(f))return"tablet"!==i&&"mobile"!==i||p.setIframeSessionStorage(this.getMobileIconKey(),c.ProjectId+","+f.Id),void this.injectInvite(c,f,g,o,i,r,l);(l=new Date).setFullYear(l.getFullYear()+1),p.updateVisit(r,l)},injectInvite:function(e,t,i,n,r,o,s){var a=iPerceptions.Wrapper,c=a.getCookie("IPE_DISP_"+e.ProjectId),l=a.getCookie("IPE_M_"+e.ProjectId),p=this.getBrowser();this.browserIsBlocked(p)||("mobile"==r||"tablet"==r?this.getInviteJsMobile(e.ProjectId,t.LanguageId,i,n,r,e.ReInviteProject):iPerceptions.ipEngine.expoTemplateId===e.TemplateId?this.getInviteJs(e.ProjectId,t.LanguageId,i,n,p,0):this.getInviteJs(e.ProjectId,t.LanguageId,i,n,p,e.ReInviteProject));for(var g=0,u=0;u<t.ProjectInviteTriggerConditions.length;u++)if(condition=t.ProjectInviteTriggerConditions[u],9==condition.ConditionTypeId){g=1e3*parseInt(condition.Value);break}iPerceptions.ipEngine.expoTemplateId===e.TemplateId||setTimeout(function(){("1"!==c||"1"!==l)&&(s=iPerceptions.ipEngine.setreinvite(e,o.history),iPerceptions.Wrapper.updateVisit(o,s))},g)},getInviteJs:function(i,n,e,r,o,s){!function(){window["ipe"+i]=window["ipe"+i]||{};var t=window["ipe"+i];t.sID=i,t.BrandID="0",t.sC="IPE"+i,t.rF="False",t.brow=o.name,t.vers=o.version,t.lID=n,t.ps="sdfc=095904e8-"+i+"-fb330c52-9ae4-4a44-a31d-b80f2c680ca0&lID="+n+"&source=91787&visitorID="+e+"&sessionID="+r+"&device=desktop&hs1=102214&hs2=91787&ipe_v"+e+"&ipe_s"+r+"&uni=1&isEvo=1",t.IPEspeed=5,t._invite="ips-invite",t.rn=i,t.sGA="",t.setupGA=function(e){return e},t.CCook=function(e,t,i){var n="",r=document.domain;if(i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),n="; expires="+o.toGMTString()}document.cookie=e+"="+t+n+"; path=/;domain="+r+";"},t.GetC=function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},t.DCook=function(e){t.CCook(e,"",-1)},t.Ld=function(){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",iPerceptions.ipEngine.invitePath+"s"+i+"/"+n+"_wVal.min.js"),document.getElementsByTagName("head")[0].appendChild(e)},t.tCv="?",t.CCook("IPEt","1",0),t.tCv=t.GetC("IPEt"),null==t.GetC(t.sC)&&null==t.GetC("IPE_S_"+i)&&null!=t.tCv&&(t.CCook(t.sC,t.sC,s),t.Ld()),t.DCook("IPEt")}()},getInviteJsMobile:function(n,r,o,s,e,a){var c="",l="",p="false";"tablet"==e?(c="Tablet",l="102215",p="true"):"mobile"==e&&(c="Mobile",l="102216",p="false"),function(){window["ipe"+n]=window["ipe"+n]||{};var i=window["ipe"+n];if(i.sGA="",i.x=window.location.protocol,i.y="//ips-invite.iperceptions.com",i.z=window.location.protocol+"//ips-mobile.iperceptions.com",i.a=n,i.ps="&hs1="+l+"&hs2=91787&ipe_v="+o+"&ipe_s="+s+"&uni=1",i.b="1",i.c=a,i.c2=10,i.d=100,i.f=window.location.protocol+"//ips-mobile.iperceptions.com",i.f2=window.location.protocol+"//collect.iperceptions.com",i.isEvo=!0,i.g=2147483647,i.i=0,i.isTablet=p,i.m=function(){this.j=window.location.href,this.k="IPE_M_"+this.a,this.l="IPE"+this.a,this.k2="IPE_DISP_"+this.a},i.n=function(){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",iPerceptions.ipEngine.invitePath+"s"+n+"/"+r+"_wVal"+c+".min.js"),document.getElementsByTagName("head")[0].appendChild(e)},i.o={},i.o.a=function(e,t,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),n=";expires="+r.toGMTString()}var o=document.domain;document.cookie=e+"="+t+n+";path=/;domain="+o+";"},i.o.b=function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},i.o.c=function(e){this.a(e,"",-1)},i.p={a:{},b:{},c:{},d:document.body,e:document.documentElement},i.p.f=function(){var e,t="IPEt"+i.a;return i.o.a(t,t,0),e=i.o.b(t),i.o.c(t),null!=e},i.q={},i.q.a=function(){return Math.round(99*Math.random())},i.p.f()){i.m();var e=i.o.b(i.k),t=i.o.b(i.k2);if(null==e){if(!(i.d>i.q.a()))return i.o.a(i.k,"0",1);i.o.a(i.k,"0",i.c),i.o.a(i.k2,"1",i.c2),i.i=1}else{if("1"!=e||"1"!=t)return;i.i=2}0<i.i&&i.n()}}()},getBrowser:function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===i[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{name:"Opera",version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),{name:i[0].replace("MSIE","IE"),version:i[1]})},browserIsBlocked:function(e){return"IE"==e.name.toString().toUpperCase()&&parseInt(e.version)<=9},getCommentCardUrl:function(e){for(var t=0;t<this.commentCardUrls.length;t++)if(0<this.commentCardUrls[t].toLowerCase().indexOf("_"+e+".js"))return this.commentCardUrls[t]},reinvite:function(e,t){var i,n,r,o=[],s=[],a=new Date;for(i=0;i<e.length;i+=1){var c=iPerceptions.Wrapper.getCookie("IPE_DISP_"+e[i].ProjectId),l=iPerceptions.Wrapper.getCookie("IPE_M_"+e[i].ProjectId);if("1"===c&&"1"===l)return s.push(e[i]),s;-10!=e[i].TemplateId&&o.push(e[i])}for(a.setFullYear(a.getFullYear()-1),i=0;i<t.length;i+=1){var p=null;for(a=a<(r=new Date(t[i].date))?r:a,n=0;n<o.length&&null===p;n+=1)o[n].ProjectId===t[i].id&&(p=n);null!=p&&(r.setDate(r.getDate()+e[p].ReInviteProject),r>new Date&&o.splice(p,1))}for(i=0;i<o.length;i+=1)(r=new Date(this.getString(a))).setDate(r.getDate()+o[i].ReInviteOtherProject),(r<=new Date||"1"===c&&"1"===l||o[i].TemplateId==iPerceptions.ipEngine.expoTemplateId)&&s.push(o[i]);return s},setreinvite:function(e,t){var i,n,r,o=new Date,s=null;for(r=o,i=this.getString(o),n=0;n<t.length;n+=1)t[n].id===e.ProjectId&&(s=n),(o=new Date(t[n].date)).setDate(o.getDate()+t[n].ReInviteProject),r=r<o?o:r;return null!==s?t[s].date=i:t.push({id:e.ProjectId,date:i,host:location.host}),r},evaluateRate:function(e,t,i,n,r,o,s,a){var c=iPerceptions.Wrapper,l=[];(t=(null!=t||null!=t)&&0<t.length?JSON.parse(t):[])instanceof Array||(t=[]);for(var p=[],g=0;g<e.length;g++){var u=e[g],d=[];for(j=0;j<u.ProjectInviteTriggers.length;j+=1)if(trigger=u.ProjectInviteTriggers[j],2!==trigger.InviteTypeId)if(-1===t.indexOf(trigger.Id)){if(0===t.length)rate="tablet"===this.device?trigger.TabletRate:"mobile"===this.device?trigger.MobileRate:trigger.DesktopRate,100*Math.random()<rate&&(p.push(trigger.Id),d.push(trigger))}else d.push(trigger);0<d.length&&(u.ProjectInviteTriggers=d,l.push(u))}0==p.length&&(p=t),c.setInvites(JSON.stringify(p)),this.getIpeStorage(l,i,n,r,o,s,a)},getString:function(e){return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()},shuffleObject:function(e){var t,i,n;for(n=e.length-1;0<=n;n-=1)Math.random()<.5&&(t=Math.floor(Math.random()*n),i=e[n],e[n]=e[t],e[t]=i);return e},evaluateInvite:function(e){var t;for(t=0;t<e.ProjectInviteTriggers.length;t+=1)if(!0===this.evaluateTrigger(e.ProjectInviteTriggers[t]))return langId=e.ProjectInviteTriggers[t].LanguageId,!0;return!1},evaluateTrigger:function(e){var t,i=e.ProjectInviteTriggerConditions[0];for(9===i.ConditionTypeId?result=!0:result=this.evaluateCondition(i),t=1;t<e.ProjectInviteTriggerConditions.length;t+=1)9!=(i=e.ProjectInviteTriggerConditions[t]).ConditionTypeId&&(!0===i.IsAnd?result=result&&this.evaluateCondition(i):result=result||this.evaluateCondition(i));return result},evaluateCondition:function(e){try{switch(e.ConditionTypeId){case 1:return this.evaluateOperation(e.ConditionOperationId,this.culture.toString(),e.Value);case 2:var t=location.href.toLowerCase();return"string"==typeof iPerceptions.Wrapper.pageUrl&&0<iPerceptions.Wrapper.pageUrl.length&&(t=iPerceptions.Wrapper.pageUrl.toLowerCase()),(3===e.ConditionOperationId||6===e.ConditionOperationId)&&0===e.Value.toLowerCase().indexOf("www")&&(t=t.replace(/^https?:\/\//,"")),this.evaluateOperation(e.ConditionOperationId,t,e.Value.toLowerCase());case 3:return this.evaluateOperation(e.ConditionOperationId,this.getQueryParam(e.Parameter),e.Value);case 4:return this.evaluateOperation(e.ConditionOperationId,iPerceptions.Wrapper.getCookie(e.Parameter),e.Value);case 5:return this.evaluateTrigger(e.CompanyInviteRule);case 6:return this.evaluateOperation(e.ConditionOperationId,this.pageViewed.toString(),e.Value);case 7:return this.evaluateOperation(e.ConditionOperationId,this.device.toLowerCase(),e.Value.toLowerCase());case 9:return!0;case 10:return this.evaluateOperation(e.ConditionOperationId,this.getFov().toString(),e.Value)}}catch(e){}},evaluateOperation:function(e,t,i){if(0<e&&e<11&&void 0===t)return!1;t=t.trim(),i=i.trim();try{switch(e){case 1:return t===i;case 2:return t!==i;case 3:return 0===t.indexOf(i.toString());case 4:return-1!==t.indexOf(i.toString());case 5:return-1===t.indexOf(i.toString());case 6:return t.toString()===i.toString();case 7:return 0<i.length&&t.substring(t.length-i.length,t.length)===i;case 8:return parseInt(t)<parseInt(i);case 9:return parseInt(t)>parseInt(i);case 10:return""!==t;case 11:return""===t;case 12:return this.getDevice(parseInt(i));case 13:return!this.getDevice(parseInt(i));case 14:return""===t;case 15:return""!==t}}catch(e){}},getQueryParam:function(e){var t,i,n,r=location.search.substring(1).split("&");for(n=0;n<r.length;n+=1)(i=r[n].split("="))[0]===e&&(void 0===t?t=i[1]:"string"==typeof t?t=[t,i[1]]:t.push(i[1]));return t instanceof Array?t.join():t},getDevice:function(e){return 1===e&&"desktop"===this.device||3===e&&"tablet"===this.device||2===e&&"mobile"===this.device},toJson:function(e){var t,i={};for(t in null==e&&(e=this),e)e.hasOwnProperty(t)&&("function"==typeof e[t]?i[t]=e[t].toString():"object"==typeof e[t]?null!=e[t]?i[t]=this.toJson(e[t]):i[t]=null:i[t]=e[t]);return JSON.stringify(i)},getSessionMobEventObj:{invites:null,ipdef:null,device:null,ct:null,visit:null,sessionId:null,wm:null,init:function(e,t,i,n,r,o){this.invites=e,this.ipdef=t,this.device=i,this.ct=n,this.visit=r,this.sessionId=o},handleEvent:function(e){try{if(0<=e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl)){var t=JSON.parse(e.data);if("universalgetsessionMob"==t.source){var i=t.value;iPerceptions.ipEngine.displayInvite(this.invites,this.ipdef,this.device,this.ct,this.visit,this.sessionId,i),window.removeEventListener("message",iPerceptions.ipEngine.getSessionMobEventObj)}}}catch(e){}}},getIpeStorage:function(e,t,i,n,r,o,s){try{var a=iPerceptions.Wrapper,c=document.getElementById(a.frameId).contentWindow;iPerceptions.ipEngine.getSessionMobEventObj.init(e,t,i,n,r,o),c.postMessage(JSON.stringify({key:this.getMobileIconKey(),method:"getsessionMob"}),"*"),a.addEvent("message",iPerceptions.ipEngine.getSessionMobEventObj,!1)}catch(e){}},getMainDomain:function(e){return e.substring(e.indexOf("://")+3).split("/")[0].split(":")[0]},getMobileIconKey:function(){var e=!1,t=iPerceptions.Wrapper;return"object"==typeof ipDef&&void 0!==ipDef.CheckMobileDomain&&(e=ipDef.CheckMobileDomain),e?"IPE_WM_"+t.companyId+"_"+this.getMainDomain(window.location.href):"IPE_WM_"+t.companyId},getFov:function(){var e=iPerceptions.Wrapper,t="ipe_"+e.companyId+"_fov",i=e.getCookie(t);if(i)try{return JSON.parse(i).numberOfVisits}catch(e){}return 0},setFovCookie:function(){var e=iPerceptions.Wrapper,t=e.getCookie("ipe_s"),i="ipe_"+e.companyId+"_fov",n=e.getCookie(i);if(n)(n=JSON.parse(n)).sessionId!=t&&(n.numberOfVisits++,n.sessionId=t,e.setCookie(i,JSON.stringify(n),new Date(n.expiry).toUTCString()));else{var r=30,o=new Date;"number"==typeof ipDef.FovCookieDays&&(r=ipDef.FovCookieDays),o.setDate(o.getDate()+r),n={numberOfVisits:1,sessionId:t,expiry:o},e.setCookie(i,JSON.stringify(n),o.toUTCString())}}};